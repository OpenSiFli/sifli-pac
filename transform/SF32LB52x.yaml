transforms:
  # ------------------------------ LPSYS ------------------------------

  # TODO: Should we separate the LCPU peripherals?

  # LPSYS peripherals
  - !DeletePeripherals
      devices: .*
      from: LPSYS_.*

  - !Delete
      from: (?i).*lpsys.*

  # LPSYS peripherals, reserved for lpsys firmware
  - !DeletePeripherals
      devices: .*
      from: (LPTIM3|BTIM[34]|CRC2|PTC2|WDT2|USART[45]|DMAC2)

  #  ------------------------------ Merge Peripherals ------------------------------

  # Merge Register Blocks
  # example: from usart2::Usart2 to usart::Usart
  - !MergeBlocks
      from: \b(\w+)\d+::(\w+)\d+\b
      to: $1::$2

  # Rename Fieldsets to avoid the following delection
  # example: from usart1::regs::cr to usart::regs::cr 
  - !Rename
      type: Fieldset
      from: \b(\w+)1::regs::(\w+)
      to: $1::regs::$2

  # Delete merged items
  - !Delete
      from: \b(\w+)\d+::.*

  # ------------------------------ PINMUX ------------------------------
  # PINMUX pad_pa[39, 42] is different with pad_pa[0, 38], [43, 44]
  
  # pad_pa[0, 38]
  - !MergeFieldsets
      from: hpsys_pinmux::regs::PadPa(0*[0-9]|[1-2][0-9]|3[0-8])\b
      to: hpsys_pinmux::regs::PadPa0_38

  - !MakeRegisterArray
      blocks: hpsys_pinmux::HpsysPinmux
      from: pad_pa(0*[0-9]|[1-2][0-9]|3[0-8])\b
      to: pad_pa0_38

  # pad_pa[39, 42]
  - !MergeFieldsets
      from: hpsys_pinmux::regs::PadPa(39|40|41|42)\b
      to: hpsys_pinmux::regs::PadPa39_42

  - !MakeRegisterArray
      blocks: hpsys_pinmux::HpsysPinmux
      from: pad_pa(39|40|41|42)\b
      to: pad_pa39_42
  
  # pad_pa[43, 44]
  - !MergeFieldsets
      from: hpsys_pinmux::regs::PadPa(43|44)\b
      to: hpsys_pinmux::regs::PadPa43_44

  - !MakeRegisterArray
      blocks: hpsys_pinmux::HpsysPinmux
      from: pad_pa(43|44)\b
      to: pad_pa43_44

  
  - !Add
      ir:
        enum/hpsys_pinmux::vals::Ps:
          bit_size: 1
          variants:
            - name: Down
              value: 0
            - name: Up
              value: 1
        enum/hpsys_pinmux::vals::Is:
          bit_size: 1
          variants:
            - name: Cmos
              value: 0
            - name: Schmitt
              value: 1
        enum/hpsys_pinmux::vals::Sr:
          bit_size: 1
          variants:
            - name: Fast
              value: 0
            - name: Slow
              value: 1
  
  - !ModifyFieldsEnum
      fieldset: hpsys_pinmux::regs::PadPa.*
      field: ps
      enum: hpsys_pinmux::vals::Ps

  - !ModifyFieldsEnum
      fieldset: hpsys_pinmux::regs::PadPa.*
      field: is
      enum: hpsys_pinmux::vals::Is

  - !ModifyFieldsEnum
      fieldset: hpsys_pinmux::regs::PadPa.*
      field: sr
      enum: hpsys_pinmux::vals::Sr
  
  # ------------------------------ GPIO ------------------------------

  # We don't need fields in the GPIO register
  - !DeleteFields
      fieldset: hpsys_gpio::regs::(\w+)r\d+\b
      from: .*

  # - !MergeFieldsets
  #     from: hpsys_gpio::regs::(\w+)r\d+\b
  #     to: hpsys_gpio::regs::$1r
  #     check: Name

  # - !MakeRegisterArray
  #     blocks: hpsys_gpio::HpsysGpio
  #     from: (\w+)r\d+\b
  #     to: $1r
  #     mode: Cursed

  # ------------------------------ RCC ------------------------------
  # fix missing fields
  - !RenameFields
      fieldset: hpsys_rcc::regs::Enr1
      from: rsvd6
      to: usart1

  - !RenameFields
      fieldset: hpsys_rcc::regs::(Enr1|Rstr1)
      from: rsvd4
      to: wdt1

  # ------------------------------ Delete Reserved ------------------------------
  # Delete Reserved Fieldsets, Registers, Fields.
  # this should go after transforms that use rsvd*
  - !DeleteFieldsets
      from: Rsvd.*

  - !DeleteRegisters
      block: .*
      from: rsvd.*

  - !DeleteFields
      fieldset: .*
      from: rsvd.*

  # ------------------------------ Interrupts ------------------------------
  # Add interrupts table
  - !AddInterrupts
      devices: .*
      interrupts:
        - name: LPTIM1   
          value: 46      
        - name: LPTIM2   
          value: 47      
        - name: PMUC     
          value: 48      
        - name: RTC      
          value: 49      
        - name: DMAC1_CH1
          value: 50      
        - name: DMAC1_CH2
          value: 51      
        - name: DMAC1_CH3
          value: 52      
        - name: DMAC1_CH4
          value: 53      
        - name: DMAC1_CH5
          value: 54      
        - name: DMAC1_CH6
          value: 55      
        - name: DMAC1_CH7
          value: 56
        - name: DMAC1_CH8
          value: 57
        - name: MAILBOX2_CH1
          value: 58
        - name: USART1
          value: 59
        - name: SPI1
          value: 60
        - name: I2C1
          value: 61
        - name: EPIC
          value: 62
        - name: LCDC1
          value: 63
        - name: I2S1
          value: 64
        - name: GPADC
          value: 65
        - name: EFUSEC
          value: 66
        - name: AES
          value: 67
        - name: PTC1
          value: 68
        - name: TRNG
          value: 69
        - name: GPTIM1
          value: 70
        - name: GPTIM2
          value: 71
        - name: BTIM1
          value: 72
        - name: BTIM2
          value: 73
        - name: USART2
          value: 74
        - name: SPI2
          value: 75
        - name: I2C2
          value: 76
        - name: EXTDMA
          value: 77
        - name: I2C4
          value: 78
        - name: SDMMC1
          value: 79
        - name: MAILBOX2_CH2
          value: 80
        - name: PDM1
          value: 82
        - name: GPIO1
          value: 84
        - name: MPI1
          value: 85
        - name: MPI2
          value: 86
        - name: EZIP1
          value: 89
        - name: AUDPRC
          value: 90
        - name: TSEN
          value: 91
        - name: USBC
          value: 92
        - name: I2C3
          value: 93
        - name: ATIM1
          value: 94
        - name: USART3
          value: 95
        - name: AUD_HP
          value: 96
        - name: SECU1
          value: 98
